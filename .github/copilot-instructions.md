# tech-ox Hugo Blog - AI Agent Instructions

## Architecture Overview

This is a **multilingual Hugo blog** using the Stack theme (git submodule at [themes/stack/](themes/stack/)). Primary language is Chinese (`zh-cn`) with support for Japanese, Arabic, and others via Hugo's i18n system.

- **Theme**: Stack theme (submodule) - card-style blog design
- **Base URL**: https://tech-ox.github.io/ (deployed via GitHub Actions)
- **Main config**: [hugo.yaml](hugo.yaml) - single source of truth for site configuration
- **Content root**: [content/](content/) - organized by post/page/categories
- **Build output**: [public/](public/) - generated by Hugo, excluded from git

## Content Structure & Conventions

### Front Matter Format
Posts use **TOML front matter** (+++...+++) with required fields:
```markdown
+++
date = '2026-01-03T15:29:50+08:00'
draft = true
title = 'MyFirstBlog'
+++
```

### Content Organization
- **Posts**: [content/post/](content/post/) - each post in its own directory with `index.md` or language variants (`index.zh-cn.md`, `index.ja.md`)
- **Pages**: [content/page/](content/page/) - about, archives, links, search
- **Categories**: [content/categories/](content/categories/) - category taxonomies
- **New posts**: Created via `hugo new content/post/<post-name>/index.md` (uses [archetypes/default.md](archetypes/default.md) template)

Example: [content/post/chinese-test/index.zh-cn.md](content/post/chinese-test/index.zh-cn.md) shows typical post structure with images, quotes, and Chinese content.

## Multilingual Setup

- **Default language**: `zh-cn` (configured in [hugo.yaml](hugo.yaml) line 8)
- **hasCJKLanguage**: Set to `true` for proper Chinese/Japanese/Korean word count
- **Language variants**: Use suffixed filenames (e.g., `index.zh-cn.md`, `index.ja.md`)
- **Translation keys**: Stored in [i18n/](i18n/) directory (theme-provided)

## Development Workflow

### Local Development Commands
```bash
hugo server -D              # Run dev server (http://localhost:1313) with drafts enabled
hugo -D                     # Build with drafts to ./public/
hugo                        # Production build (no drafts)
hugo new content/post/<post-name>/index.md  # Create new post from template
```

### Building & Previewing Locally
- Hugo watch mode is automatic when using `hugo server`
- Drafts are hidden unless `-D` flag is used (production site only shows published=true)
- Rebuild is fast due to incremental processing in Hugo
- Test CNAME resolution locally by checking generated [public/CNAME](public/CNAME)

### Creating New Content
```bash
hugo new content/post/<post-name>/index.md
# Edit the generated file in content/post/<post-name>/
# Place images in same directory, reference as ![](image.jpg)
```

### Theme Customization
- **Do NOT edit** [themes/stack/](themes/stack/) directly (git submodule)
- **Override theme files** by copying to [layouts/](layouts/) (currently empty)
- **Custom assets**: Place in [assets/](assets/) directory
- **Static files**: Place in [static/](static/) (avatars, favicons, etc.)

## Deployment Pipeline

**GitHub Actions** ([.github/workflows/hugo_deploy.yaml](.github/workflows/hugo_deploy.yaml)):
- Triggers on push to `main` branch
- Uses latest Hugo extended version
- Builds site with `hugo -D` (includes drafts)
- Deploys to external repository: `chengang9904/chengang9904.github.io`
- Requires `secrets.token` for deployment authentication
- **Important**: Submodules are fetched automatically during deployment (configured in workflow)

## Configuration Highlights

From [hugo.yaml](hugo.yaml):
- **Pagination**: 10 posts per page (`pagerSize: 10`)
- **Permalinks**: `/p/:slug/` for posts
- **Main sections**: Only `post`
- **Sidebar avatar**: Enabled, stored at `img/avatar.png`
- **Math typesetting**: Enabled (`math: true`, line 69)
- **Table of contents**: Enabled for articles (`toc: true`)
- **Reading time**: Enabled for articles (`readingTime: true`)
- **Comments**: Disabled (provider: disqus - unconfigured)
- **Base URL**: `http://tech-ox.com/` (with CNAME in GitHub Pages deployment)

## Common Patterns

1. **Images in posts**: Place in post directory, reference relatively: `![alt text](image.jpg)`
2. **Draft posts**: Set `draft = true` in front matter; include with `-D` flag
3. **Menu customization**: Add `menu` field to front matter (see [content/_index.zh-cn.md](content/_index.zh-cn.md))
4. **Widgets**: Configured in [hugo.yaml](hugo.yaml) lines 163-172 (search, archives, categories, tag-cloud)
5. **Post structure**: Posts with multiple content files like [content/post/frontend/vue/todomvc/](content/post/frontend/vue/todomvc/) organize content hierarchically

## Workflow Gotchas & Tips

- **Always use `hugo server -D` during development** to preview drafts in real-time
- **Commit `.hugo_build.lock`** - it tracks build state and improves incremental builds
- **Don't force-edit [themes/stack/](themes/stack/)** - theme is a git submodule; create [layouts/](layouts/) overrides instead
- **Deployment is automatic** - pushing to `main` triggers GitHub Actions, which builds and deploys to `chengang9904/chengang9904.github.io`
- **CNAME validation** - GitHub Actions automatically creates [public/CNAME](public/CNAME) with `tech-ox.com`
- **Draft posts still deploy** - workflow uses `hugo build` with `-D` (no flag shows drafts too). For hidden drafts, use `hugo build` without `-D`
- **Image processing** - Enabled in [hugo.yaml](hugo.yaml) for both cover and content images; uses Hugo pipes internally

## Important Notes

- **Never commit** [public/](public/) or [resources/](resources/) directories (see [.gitignore](.gitignore))
- **Theme as git submodule**: Theme is tracked via [.gitmodules](.gitmodules), not directly committed
  - Clone with submodules: `git clone --recurse-submodules <repo-url>`
  - Initialize after clone: `git submodule update --init --recursive`
  - Update theme: `git submodule update --remote themes/stack`
  - **Never** run `git submodule add` if theme already exists (check `.gitmodules` first)
- **Configuration**: All site settings in [hugo.yaml](hugo.yaml), not split across multiple files
- **Content dates**: Use ISO 8601 format with timezone: `2026-01-03T15:29:50+08:00`
- **Build lock**: [.hugo_build.lock](.hugo_build.lock) is auto-generated, should be committed
